## 概述

相关源文件

+   [binaries/linux_amd64/CloudflareST-Rust](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/binaries/linux_amd64/CloudflareST-Rust)
+   [binaries/macos_arm64/CloudflareST-Rust](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/binaries/macos_arm64/CloudflareST-Rust)
+   [binaries/windows_x86_64/CloudflareST-Rust.exe](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/binaries/windows_x86_64/CloudflareST-Rust.exe)
+   [src/main.rs](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/main.rs)

CloudflareST-Rust是一个网络性能测试工具，旨在评估和优化与Cloudflare基础设施的连接。本文档全面介绍了CloudflareST-Rust的系统架构、核心组件和操作流程。有关安装和使用的详细信息，请参阅[安装与使用](https://deepwiki.com/GuangYu-yu/CloudflareST-Rust/2-installation-and-usage)。

## 功能与用途

CloudflareST-Rust通过多种测试方法评估与Cloudflare内容分发网络(CDN)的网络连接性能，包括TCP、HTTP和ICMP ping测试，以及可选的下载速度测量。该工具帮助用户根据延迟、丢包率和吞吐量等指标识别最优的Cloudflare边缘服务器(colo)。

主要功能包括：

+   **多种测试方法**：可配置参数的TCP、HTTP和ICMP ping测试
+   **下载速度测试**：测量选定服务器的实际吞吐量
+   **IP过滤**：基于延迟、丢包率等指标的高级过滤
+   **结果排序**：根据用户定义的标准对服务器进行排序和选择
+   **跨平台支持**：在Windows、macOS和Linux上提供原生性能

来源：[src/main.rs1-15](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/main.rs#L1-L15) [src/main.rs42-57](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/main.rs#L42-L57)

## 系统架构

CloudflareST-Rust采用模块化架构，不同网络测试方面由独立组件实现。系统的核心是基于并发测试框架构建，能高效管理网络操作。

来源：[src/main.rs1-10](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/main.rs#L1-L10) [src/main.rs42-57](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/main.rs#L42-L57)

## 测试流程

CloudflareST-Rust遵循从初始化到结果输出的系统化工作流程。应用程序处理命令行参数，选择合适的测试方法，执行测试并输出结果。

来源：[src/main.rs20-85](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/main.rs#L20-L85)

## 数据结构

CloudflareST-Rust使用几个关键数据结构来管理测试数据和结果。最重要的是`PingResult`枚举，它封装了不同类型ping测试的结果。

来源：[src/main.rs93-99](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/main.rs#L93-L99) [src/common.rs](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/common.rs)

## 线程池与并发

CloudflareST-Rust采用复杂的线程池来高效管理并发网络操作。线程池根据系统能力和网络条件动态调整并发操作数量。

来源：[src/pool.rs](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/pool.rs)

## 跨平台支持

CloudflareST-Rust是一个跨平台应用程序，为多种架构编译，可在不同操作系统上提供原生性能。下表总结了支持的平台和架构：

| 操作系统 | 架构 | 二进制文件位置 |
| --- | --- | --- |
| macOS | ARM64(Apple Silicon), x86_64(Intel) | `binaries/macos_arm64/`, `binaries/macos_x86_64/` |
| Windows | ARM64, x86_64 | `binaries/windows_arm64/`, `binaries/windows_x86_64/` |
| Linux | ARM64, AMD64(x86_64) | `binaries/linux_arm64/`, `binaries/linux_amd64/` |

该应用程序在所有平台上保持功能一致，同时在可能的情况下利用平台特定的优化。

来源：[binaries/macos_arm64/CloudflareST-Rust](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/binaries/macos_arm64/CloudflareST-Rust) [binaries/windows_x86_64/CloudflareST-Rust.exe](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/binaries/windows_x86_64/CloudflareST-Rust.exe)

## 执行流程

CloudflareST-Rust的执行流程从main函数开始，该函数协调应用程序操作的所有方面。

来源：[src/main.rs20-85](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/main.rs#L20-L85)

## 网络测试方法

CloudflareST-Rust实现了三种主要的网络测试方法，每种方法都有独特的特点和用例。有关每种测试方法的详细信息，请参阅[网络测试方法](https://deepwiki.com/GuangYu-yu/CloudflareST-Rust/4-network-testing-methods)。

| 测试方法 | 模块 | 描述 | 默认端口/协议 |
| --- | --- | --- | --- |
| TCP Ping | `tcping.rs` | 测试TCP连接建立时间 | 可配置(默认:443) |
| HTTP Ping | `httping.rs` | 测试HTTP请求-响应时间 | HTTP(S)端口443 |
| ICMP Ping | `icmp.rs` | 使用ICMP回显请求/回复 | ICMP协议 |
| 下载测试 | `download.rs` | 测量实际下载速度 | HTTP(S)端口443 |

根据命令行参数选择适当的测试方法，如果未指定特定方法，则默认使用TCP ping。

来源：[src/main.rs42-57](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/main.rs#L42-L57) [src/tcping.rs](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/tcping.rs) [src/httping.rs](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/httping.rs) [src/icmp.rs](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/icmp.rs) [src/download.rs](https://github.com/GuangYu-yu/CloudflareST-Rust/blob/57de4236/src/download.rs)